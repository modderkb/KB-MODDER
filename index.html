<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prediction AI - Live</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');
    body {
      background: linear-gradient(to right, #000000, #0f0f0f);
      color: #00ffcc;
      font-family: 'Orbitron', sans-serif;
      margin: 0;
      padding-bottom: 100px;
    }
    .card, .box {
      max-width: 600px;
      margin: 40px auto;
      background: rgba(20, 20, 20, 0.95);
      border-radius: 20px;
      padding: 30px 25px;
      border: 2px solid #00ffff;
      display: none;
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from {
        box-shadow: 0 0 10px #0ff, 0 0 30px #0ff;
      }
      to {
        box-shadow: 0 0 30px #0ff, 0 0 80px #0ff;
      }
    }
    .card-active { display: block; }
    h2 {
      text-align: center;
      color: #ffffff;
      font-size: 36px;
      margin-bottom: 30px;
      text-shadow: 0 0 15px #ff0, 0 0 25px #f0f;
    }
    .label {
      font-size: 14px;
      color: #cccccc;
      margin-top: 20px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }
    .result {
      font-size: 32px;
      text-align: center;
      margin: 15px 0 25px;
      color: #00ffee;
      animation: pulse 1.5s ease-in-out infinite alternate;
    }
    .big-small {
      text-align: center;
      font-size: 40px;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 20px #0ff, 0 0 40px #00f;
      background: linear-gradient(to right, #111, #1f1f1f);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 0 30px #00ffff99;
    }
    @keyframes pulse {
      0% { transform: scale(1); text-shadow: 0 0 10px #0f0; }
      100% { transform: scale(1.1); text-shadow: 0 0 20px #ff0; color: #ff0; }
    }
    #historyBox {
      margin-top: 25px;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    .history-entry {
      margin: 8px 0;
      font-size: 16px;
      padding: 6px;
      background: #222;
      border-radius: 8px;
      box-shadow: 0 0 10px #00ffff44 inset;
    }
  </style>
</head>
<body>

<!-- HOME -->
<div class="box card-active" id="home">
  <h2>NEXTGEN PREDICTOR</h2>
  <div class="label"> Current Period</div>
  <div class="result" id="periodDisplay" style="font-size: 20px">-</div>
  <div class="label"> Predicted Numbers</div>
  <div class="result" id="predictionDisplay">-</div>
  <div class="big-small" id="bigSmallDisplay">-</div>
  <div class="label">ðŸ“œ Prediction History</div>
  <div id="historyBox"></div>
</div>

<script>
let lastPeriod = null;
let pastResults = [];
let historyLog = [];
let useOpposite = false;

function generatePeriodNumber() {
  let now = new Date();
  let utc = new Date(now.getTime() + now.getTimezoneOffset() * 60000);
  let year = utc.getFullYear();
  let month = String(utc.getMonth() + 1).padStart(2, '0');
  let day = String(utc.getDate()).padStart(2, '0');
  let minutes = utc.getHours() * 60 + utc.getMinutes();
  return `${year}${month}${day}1000${10001 + minutes}`;
}

function smartAlternative(prediction) {
  let group = prediction >= 5 ? [5,6,7,8,9] : [0,1,2,3,4];
  let alternatives = group.filter(n => n !== prediction);
  return alternatives[Math.floor(Math.random() * alternatives.length)];
}

function getPrediction(period) {
  let prediction;
  if (pastResults.length >= 5) {
    let freq = Array(10).fill(0);
    pastResults.slice(-15).forEach(n => freq[n]++);
    const minFreq = Math.min(...freq);
    const rare = freq.map((f, i) => f === minFreq ? i : null).filter(v => v !== null);

    const last = pastResults[pastResults.length - 1];
    const secondLast = pastResults[pastResults.length - 2];
    const trend = (last + (last - secondLast) + 10) % 10;

    prediction = rare.includes(trend)
      ? trend
      : rare[Math.floor(Math.random() * rare.length)];
  } else {
    const ai = parseInt(period.slice(-4)) % 2 === 0 ? "SMALL" : "BIG";
    const sum9 = [...period.slice(-9)].reduce((s,d)=>s+parseInt(d),0);
    const pred9 = (sum9 % 10 >= 5) ? 'SMALL' : 'BIG';
    const pred10 = (parseInt(period.slice(-10)) % 10 >= 5) ? 'SMALL' : 'BIG';
    const result = [ai, pred9, pred10].filter(p => p === 'BIG').length >= 2 ? 'BIG' : 'SMALL';

    const base = useOpposite ? (result === 'BIG' ? 0 : 9) : (result === 'BIG' ? 9 : 0);
    prediction = smartAlternative(base);
  }

  pastResults.push(prediction);
  if (pastResults.length > 100) pastResults.shift();

  const alt = smartAlternative(prediction);
  return [prediction, alt];
}

function renderHistory() {
  const box = document.getElementById("historyBox");
  box.innerHTML = historyLog.map(entry => `
    <div class="history-entry">
      ðŸ•’ <b>${entry.period}</b> - Prediction: <span style="color:#00ffee">${entry.prediction.join(', ')}</span>
    </div>
  `).join('');
}

async function fetchResultFromAPI() {
  try {
    const res = await fetch("https://api.bdg88zf.com/api/webapi/GetNoaverageEmerdList", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        pageSize: 10,
        pageNo: 1,
        typeId: 1,
        language: 0,
        random: "4a0522c6ecd8410496260e686be2a57c",
        signature: "334B5E70A0C9B8918B0B15E517E2069C",
        timestamp: Math.floor(Date.now() / 1000)
      })
    });
    const json = await res.json();
    return json?.data?.list || [];
  } catch (e) {
    console.error("API error:", e);
    return [];
  }
}

async function updatePrediction() {
  const results = await fetchResultFromAPI();
  if (results.length === 0) return;

  const currentPeriod = generatePeriodNumber();
  if (currentPeriod === lastPeriod) return;
  lastPeriod = currentPeriod;

  const latest = results[0];
  const actual = parseInt(latest.number);
  pastResults.push(actual);
  if (pastResults.length > 100) pastResults.shift();

  const [prediction, alt] = getPrediction(currentPeriod);
  const sizeType = prediction >= 5 ? "BIG" : "SMALL";
  const sizeColor = sizeType === "BIG" ? "#ff3366" : "#33ffcc";

  document.getElementById("periodDisplay").textContent = ` ${currentPeriod}`;
  document.getElementById("predictionDisplay").textContent = `${prediction}, ${alt}`;
  document.getElementById("bigSmallDisplay").textContent = sizeType;
  document.getElementById("bigSmallDisplay").style.color = sizeColor;

  historyLog.unshift({ period: currentPeriod, prediction: [prediction, alt] });
  if (historyLog.length > 30) historyLog.pop();
  renderHistory();
}

setInterval(updatePrediction, 5000);
</script>
</body>
</html>
